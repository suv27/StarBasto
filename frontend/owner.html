<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarBasto | Owner Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-slate-50 font-sans min-h-screen">

    <nav class="bg-blue-900 text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2">
            <i data-lucide="shield-check" class="text-yellow-400"></i>
            <h1 class="text-xl font-black tracking-tight italic">StarBasto <span class="font-light not-italic text-blue-200">Admin</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <span class="hidden md:block text-xs font-mono text-blue-300">SHIELD: ACTIVE</span>
            <button onclick="fetchAll()" class="bg-blue-700 p-2 rounded-lg hover:bg-blue-600 transition">
                <i data-lucide="refresh-cw" size="20"></i>
            </button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-8 space-y-8">
        
        <section>
            <div class="flex items-center gap-2 mb-4">
                <i data-lucide="truck" class="text-blue-600"></i>
                <h2 class="text-xl font-bold text-slate-800">Pedidos Recientes</h2>
            </div>
            
            <div id="orders-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <p class="text-slate-400 italic">No hay pedidos pendientes...</p>
            </div>
        </section>

        <section>
            <div class="flex items-center gap-2 mb-4">
                <i data-lucide="package" class="text-blue-600"></i>
                <h2 class="text-xl font-bold text-slate-800">Inventario del Colmado</h2>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
                        <tr>
                            <th class="px-6 py-4">Producto</th>
                            <th class="px-6 py-4">Precio (RD$)</th>
                            <th class="px-6 py-4">Stock</th>
                            <th class="px-6 py-4 text-right">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-table-body" class="divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>
        </section>

    </main>

    <script>
        const API_BASE = "http://127.0.0.1:8000";
        const AUTH_HEADER = { 'X-Star-Defense-Key': 'StarBasto_Secure_2026' };

        // 1. Fetch Inventory & Orders
        async function fetchAll() {
            fetchInventory();
            // In a real app, we'd fetch orders here too. 
            // For now, let's focus on the Inventory display.
        }

        async function fetchInventory() {
            try {
                const res = await fetch(`${API_BASE}/owner/inventory`, { headers: AUTH_HEADER });
                const products = await res.json();
                const table = document.getElementById('inventory-table-body');
                
                table.innerHTML = Object.entries(products).map(([barcode, item]) => `
                    <tr class="hover:bg-blue-50/50 transition">
                        <td class="px-6 py-4">
                            <div class="font-bold text-slate-800">${item.name}</div>
                            <div class="text-xs text-slate-400 font-mono">${barcode}</div>
                        </td>
                        <td class="px-6 py-4 font-mono font-bold text-blue-600">${item.price}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded-md text-xs font-bold ${item.stock < 10 ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}">
                                ${item.stock} disp.
                            </span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button class="text-slate-400 hover:text-blue-600"><i data-lucide="edit-3" size="18"></i></button>
                        </td>
                    </tr>
                `).join('');
                lucide.createIcons();
            } catch (err) {
                console.error("Dashboard Error:", err);
            }
        }

        // Initialize
        fetchAll();
        // Auto-refresh every 30 seconds
        setInterval(fetchAll, 30000);
    </script>
</body>
</html>